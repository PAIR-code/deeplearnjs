{"dependencies":[{"name":"/usr/local/google/home/nsthorat/deeplearnjs-clients/float16/tfjs-core/tsconfig.json","includedInParent":true,"mtime":1532457398879},{"name":"/usr/local/google/home/nsthorat/deeplearnjs-clients/float16/tfjs-core/test/package.json","includedInParent":true,"mtime":1530637734514}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar SegmentOpProgram = function () {\n    function SegmentOpProgram(segOpInfo, segOpType) {\n        this.variableNames = ['x', 'segmentIds'];\n        var windowSize = segOpInfo.windowSize;\n        var batchSize = segOpInfo.batchSize;\n        var inSize = segOpInfo.inSize;\n        var numSegments = segOpInfo.numSegments;\n        var outSize = numSegments * Math.ceil(inSize / windowSize);\n        this.outputShape = [batchSize, outSize];\n        var initializationValue = '0.0';\n        var returnValue = \"sumValue\";\n        var windowSizeNearestVec4 = Math.floor(windowSize / 4) * 4;\n        var windowSizeVec4Remainder = windowSize % 4;\n        var updateSnippet = \"\\n        sumValue += dot(values, filter);\\n    \";\n        var checkValueOutOfBounds = '';\n        if (inSize % windowSize > 0) {\n            checkValueOutOfBounds = \"\\n        if (inIdx < 0 || inIdx >= \" + inSize + \") {\\n          return initializationValue;\\n        }\\n      \";\n        }\n        var checkSegmentIdOutOfBounds = '';\n        if (inSize % windowSize > 0) {\n            checkSegmentIdOutOfBounds = \"\\n        if (inIdx < 0 || inIdx >= \" + inSize + \") {\\n          return -1.0;\\n        }\\n      \";\n        }\n        this.userCode = \"\\n      const float initializationValue = \" + initializationValue + \";\\n\\n      float getValue(int batch, int inIdx) {\\n        \" + checkValueOutOfBounds + \"\\n        return getX(batch, inIdx);\\n      }\\n\\n      float getSegmentIdAtIndex(int inIdx) {\\n        \" + checkSegmentIdOutOfBounds + \"\\n        return getSegmentIds(inIdx);\\n      }\\n\\n      void main() {\\n        ivec2 coords = getOutputCoords();\\n        int batch = coords[0];\\n        int outIdx = coords[1];\\n        int inOffset = int(floor(float(outIdx) / float(\\n          \" + numSegments + \")) * float(\" + windowSize + \"));\\n        int currentSeg = int(mod(float(outIdx), float(\" + numSegments + \")));\\n\\n        float sumValue = 0.0;\\n\\n        for (int i = 0; i < \" + windowSizeNearestVec4 + \"; i += 4) {\\n          int inIdx = inOffset + i;\\n          vec4 values = vec4(\\n            getValue(batch, inIdx),\\n            getValue(batch, inIdx + 1),\\n            getValue(batch, inIdx + 2),\\n            getValue(batch, inIdx + 3)\\n          );\\n\\n          vec4 filter = vec4(\\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\\n          );\\n\\n          \" + updateSnippet + \"\\n        }\\n\\n        int inIdx = inOffset + \" + windowSizeNearestVec4 + \";\\n        if (\" + (windowSizeVec4Remainder === 1) + \") {\\n          vec4 values = vec4(\\n            getValue(batch, inIdx),\\n            initializationValue,\\n            initializationValue,\\n            initializationValue\\n          );\\n\\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\\n\\n          vec4 filter = vec4(\\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\\n            0,\\n            0,\\n            0\\n          );\\n\\n          \" + updateSnippet + \"\\n        } else if (\" + (windowSizeVec4Remainder === 2) + \") {\\n          vec4 values = vec4(\\n            getValue(batch, inIdx),\\n            getValue(batch, inIdx + 1),\\n            initializationValue,\\n            initializationValue\\n          );\\n\\n          vec4 filter = vec4(\\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\\n              0,\\n              0\\n          );\\n\\n          \" + updateSnippet + \"\\n        } else if (\" + (windowSizeVec4Remainder === 3) + \") {\\n          vec4 values = vec4(\\n            getValue(batch, inIdx),\\n            getValue(batch, inIdx + 1),\\n            getValue(batch, inIdx + 2),\\n            initializationValue\\n          );\\n\\n          vec4 filter = vec4(\\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\\n            0\\n          );\\n\\n          \" + updateSnippet + \"\\n        }\\n        setOutput(\" + returnValue + \");\\n      }\\n    \";\n    }\n    return SegmentOpProgram;\n}();\nexports.SegmentOpProgram = SegmentOpProgram;","map":{"mappings":[{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":4,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":4,"column":4}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":4,"column":23}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":4,"column":35}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":26,"column":2},"generated":{"line":5,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":26,"column":2},"generated":{"line":5,"column":13}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":26,"column":2},"generated":{"line":5,"column":29}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":26,"column":14},"generated":{"line":5,"column":30}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":26,"column":2},"generated":{"line":5,"column":39}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":26,"column":36},"generated":{"line":5,"column":41}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":26,"column":2},"generated":{"line":5,"column":50}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":26,"column":67},"generated":{"line":5,"column":52}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":22,"column":2},"generated":{"line":6,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":22,"column":2},"generated":{"line":6,"column":13}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":22,"column":2},"generated":{"line":6,"column":26}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":22,"column":18},"generated":{"line":6,"column":29}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":22,"column":19},"generated":{"line":6,"column":30}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":22,"column":18},"generated":{"line":6,"column":33}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":22,"column":24},"generated":{"line":6,"column":35}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":22,"column":18},"generated":{"line":6,"column":47}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":22,"column":2},"generated":{"line":6,"column":48}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":27,"column":4},"generated":{"line":7,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":27,"column":10},"generated":{"line":7,"column":12}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":27,"column":23},"generated":{"line":7,"column":25}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":27,"column":33},"generated":{"line":7,"column":35}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":27,"column":4},"generated":{"line":7,"column":45}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":28,"column":4},"generated":{"line":8,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":28,"column":10},"generated":{"line":8,"column":12}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":28,"column":22},"generated":{"line":8,"column":24}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":28,"column":32},"generated":{"line":8,"column":34}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":28,"column":4},"generated":{"line":8,"column":43}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":29,"column":4},"generated":{"line":9,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":29,"column":10},"generated":{"line":9,"column":12}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":29,"column":19},"generated":{"line":9,"column":21}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":29,"column":29},"generated":{"line":9,"column":31}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":29,"column":4},"generated":{"line":9,"column":37}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":30,"column":4},"generated":{"line":10,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":30,"column":10},"generated":{"line":10,"column":12}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":30,"column":24},"generated":{"line":10,"column":26}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":30,"column":34},"generated":{"line":10,"column":36}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":30,"column":4},"generated":{"line":10,"column":47}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":31,"column":4},"generated":{"line":11,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":31,"column":10},"generated":{"line":11,"column":12}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":31,"column":20},"generated":{"line":11,"column":22}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":31,"column":34},"generated":{"line":11,"column":36}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":31,"column":39},"generated":{"line":11,"column":41}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":31,"column":34},"generated":{"line":11,"column":45}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":31,"column":44},"generated":{"line":11,"column":46}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":31,"column":53},"generated":{"line":11,"column":55}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":31,"column":34},"generated":{"line":11,"column":65}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":31,"column":4},"generated":{"line":11,"column":66}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":32,"column":4},"generated":{"line":12,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":32,"column":9},"generated":{"line":12,"column":13}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":32,"column":4},"generated":{"line":12,"column":24}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":32,"column":23},"generated":{"line":12,"column":27}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":32,"column":24},"generated":{"line":12,"column":28}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":32,"column":23},"generated":{"line":12,"column":37}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":32,"column":35},"generated":{"line":12,"column":39}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":32,"column":23},"generated":{"line":12,"column":46}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":32,"column":4},"generated":{"line":12,"column":47}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":34,"column":4},"generated":{"line":13,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":34,"column":10},"generated":{"line":13,"column":12}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":34,"column":32},"generated":{"line":13,"column":34}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":34,"column":4},"generated":{"line":13,"column":39}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":35,"column":4},"generated":{"line":14,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":35,"column":10},"generated":{"line":14,"column":12}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":35,"column":24},"generated":{"line":14,"column":26}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":35,"column":4},"generated":{"line":14,"column":36}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":37,"column":4},"generated":{"line":15,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":37,"column":10},"generated":{"line":15,"column":12}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":37,"column":34},"generated":{"line":15,"column":36}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":37,"column":39},"generated":{"line":15,"column":41}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":37,"column":34},"generated":{"line":15,"column":46}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":37,"column":45},"generated":{"line":15,"column":47}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":37,"column":58},"generated":{"line":15,"column":60}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":37,"column":34},"generated":{"line":15,"column":61}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":37,"column":63},"generated":{"line":15,"column":65}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":37,"column":4},"generated":{"line":15,"column":66}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":38,"column":4},"generated":{"line":16,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":38,"column":10},"generated":{"line":16,"column":12}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":38,"column":36},"generated":{"line":16,"column":38}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":38,"column":49},"generated":{"line":16,"column":51}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":38,"column":4},"generated":{"line":16,"column":52}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":40,"column":4},"generated":{"line":17,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":40,"column":10},"generated":{"line":17,"column":12}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":40,"column":26},"generated":{"line":17,"column":28}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":40,"column":4},"generated":{"line":17,"column":78}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":44,"column":4},"generated":{"line":18,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":44,"column":8},"generated":{"line":18,"column":12}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":44,"column":32},"generated":{"line":18,"column":36}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":44,"column":4},"generated":{"line":18,"column":38}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":45,"column":4},"generated":{"line":19,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":45,"column":8},"generated":{"line":19,"column":12}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":45,"column":17},"generated":{"line":19,"column":21}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":45,"column":8},"generated":{"line":19,"column":31}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":45,"column":30},"generated":{"line":19,"column":34}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":45,"column":4},"generated":{"line":19,"column":35}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":45,"column":33},"generated":{"line":19,"column":37}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":46,"column":6},"generated":{"line":20,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":46,"column":30},"generated":{"line":20,"column":36}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":47,"column":36},"generated":{"line":20,"column":77}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":46,"column":30},"generated":{"line":20,"column":83}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":47,"column":42},"generated":{"line":20,"column":86}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":46,"column":6},"generated":{"line":20,"column":149}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":51,"column":5},"generated":{"line":21,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":53,"column":4},"generated":{"line":22,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":53,"column":8},"generated":{"line":22,"column":12}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":53,"column":36},"generated":{"line":22,"column":40}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":53,"column":4},"generated":{"line":22,"column":42}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":54,"column":4},"generated":{"line":23,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":54,"column":8},"generated":{"line":23,"column":12}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":54,"column":17},"generated":{"line":23,"column":21}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":54,"column":8},"generated":{"line":23,"column":31}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":54,"column":30},"generated":{"line":23,"column":34}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":54,"column":4},"generated":{"line":23,"column":35}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":54,"column":33},"generated":{"line":23,"column":37}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":55,"column":6},"generated":{"line":24,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":55,"column":34},"generated":{"line":24,"column":40}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":56,"column":36},"generated":{"line":24,"column":81}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":55,"column":34},"generated":{"line":24,"column":87}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":56,"column":42},"generated":{"line":24,"column":90}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":55,"column":6},"generated":{"line":24,"column":138}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":60,"column":5},"generated":{"line":25,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":4},"generated":{"line":26,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":9},"generated":{"line":26,"column":13}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":4},"generated":{"line":26,"column":21}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":24}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":63,"column":42},"generated":{"line":26,"column":71}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":90}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":63,"column":61},"generated":{"line":26,"column":93}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":154}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":66,"column":10},"generated":{"line":26,"column":157}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":178}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":66,"column":31},"generated":{"line":26,"column":181}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":286}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":71,"column":10},"generated":{"line":26,"column":289}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":314}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":71,"column":35},"generated":{"line":26,"column":317}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":566}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":80,"column":12},"generated":{"line":26,"column":569}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":580}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":80,"column":23},"generated":{"line":26,"column":583}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":596}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":80,"column":37},"generated":{"line":26,"column":599}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":609}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":80,"column":47},"generated":{"line":26,"column":612}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":673}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":81,"column":56},"generated":{"line":26,"column":676}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":687}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":81,"column":67},"generated":{"line":26,"column":690}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":761}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":85,"column":30},"generated":{"line":26,"column":764}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":785}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":85,"column":51},"generated":{"line":26,"column":788}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":1386}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":101,"column":12},"generated":{"line":26,"column":1389}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":1402}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":101,"column":25},"generated":{"line":26,"column":1405}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":1453}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":104,"column":33},"generated":{"line":26,"column":1456}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":1477}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":104,"column":54},"generated":{"line":26,"column":1480}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":1497}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":105,"column":14},"generated":{"line":26,"column":1501}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":105,"column":42},"generated":{"line":26,"column":1529}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":1530}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":105,"column":43},"generated":{"line":26,"column":1534}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":1959}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":122,"column":12},"generated":{"line":26,"column":1962}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":1975}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":122,"column":25},"generated":{"line":26,"column":1978}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":2001}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":123,"column":21},"generated":{"line":26,"column":2005}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":123,"column":49},"generated":{"line":26,"column":2033}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":2034}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":123,"column":50},"generated":{"line":26,"column":2038}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":2469}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":138,"column":12},"generated":{"line":26,"column":2472}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":2485}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":138,"column":25},"generated":{"line":26,"column":2488}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":2511}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":139,"column":21},"generated":{"line":26,"column":2515}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":139,"column":49},"generated":{"line":26,"column":2543}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":2544}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":139,"column":50},"generated":{"line":26,"column":2548}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":3038}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":154,"column":12},"generated":{"line":26,"column":3041}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":3054}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":154,"column":25},"generated":{"line":26,"column":3057}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":3090}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":156,"column":20},"generated":{"line":26,"column":3093}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":26,"column":3104}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":156,"column":31},"generated":{"line":26,"column":3107}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":62,"column":4},"generated":{"line":26,"column":3126}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":159,"column":3},"generated":{"line":27,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":160,"column":0},"generated":{"line":28,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":160,"column":0},"generated":{"line":28,"column":11}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":160,"column":0},"generated":{"line":28,"column":27}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":29,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":29,"column":1}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":21,"column":0},"generated":{"line":29,"column":3}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":30,"column":0}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":30,"column":8}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":30,"column":24}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":30,"column":27}},{"source":"../src/kernels/webgl/segment_gpu.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":30,"column":43}}],"sources":{"../src/kernels/webgl/segment_gpu.ts":"/**\n * @license\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport {SegOpInfo} from '../../ops/segment_util';\nimport {GPGPUProgram} from './gpgpu_math';\n\nexport class SegmentOpProgram implements GPGPUProgram {\n  variableNames = ['x', 'segmentIds'];\n  outputShape: number[];\n  userCode: string;\n\n  constructor(segOpInfo: SegOpInfo, segOpType: 'unsortedSegmentSum') {\n    const windowSize = segOpInfo.windowSize;\n    const batchSize = segOpInfo.batchSize;\n    const inSize = segOpInfo.inSize;\n    const numSegments = segOpInfo.numSegments;\n    const outSize = numSegments * Math.ceil(inSize / windowSize);\n    this.outputShape = [batchSize, outSize];\n\n    const initializationValue = '0.0';\n    const returnValue = `sumValue`;\n\n    const windowSizeNearestVec4 = Math.floor(windowSize / 4) * 4;\n    const windowSizeVec4Remainder = windowSize % 4;\n\n    const updateSnippet = `\n        sumValue += dot(values, filter);\n    `;\n\n    let checkValueOutOfBounds = '';\n    if (inSize % windowSize > 0) {\n      checkValueOutOfBounds = `\n        if (inIdx < 0 || inIdx >= ${inSize}) {\n          return initializationValue;\n        }\n      `;\n    }\n\n    let checkSegmentIdOutOfBounds = '';\n    if (inSize % windowSize > 0) {\n      checkSegmentIdOutOfBounds = `\n        if (inIdx < 0 || inIdx >= ${inSize}) {\n          return -1.0;\n        }\n      `;\n    }\n\n    this.userCode = `\n      const float initializationValue = ${initializationValue};\n\n      float getValue(int batch, int inIdx) {\n        ${checkValueOutOfBounds}\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ${checkSegmentIdOutOfBounds}\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ${numSegments})) * float(${windowSize}));\n        int currentSeg = int(mod(float(outIdx), float(${numSegments})));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${windowSizeNearestVec4}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ${updateSnippet}\n        }\n\n        int inIdx = inOffset + ${windowSizeNearestVec4};\n        if (${windowSizeVec4Remainder === 1}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ${updateSnippet}\n        } else if (${windowSizeVec4Remainder === 2}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ${updateSnippet}\n        } else if (${windowSizeVec4Remainder === 3}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ${updateSnippet}\n        }\n        setOutput(${returnValue});\n      }\n    `;\n  }\n}\n"},"lineCount":null}},"hash":"0c6cd5d545100e0c9a5a053b8b698399","cacheData":{"env":{}}}