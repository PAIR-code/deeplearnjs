<script src="../dist/deeplearn-caffe-models.js"></script>
 
<img id="img"></img>
<div id="result"></div>

<script>
  const img = document.getElementById('img');
  img.onload = async () => {
    const resultElement = document.getElementById('result');
    const dl = deeplearnCaffeModels.dl;
    const CAFFE_MODEL = deeplearnCaffeModels.GenderNet;

    resultElement.innerText = 'Loading model...';

    if (dl == null) {
      await new Promise(resolve => setTimeout(resolve, 1000));
    }
    const math = new dl.NDArrayMathGPU();
    const model = new CAFFE_MODEL(math);
    await model.load();

    resultElement.innerText = 'Predicting...';

    const pixels = dl.Array3D.fromPixels(img);

    const result = await model.predict(pixels);

    resultElement.innerText = '';

    const k = 2;
    const topK = await deeplearnCaffeModels.util.getTopK(result, k);

    for (let i = 0; i < k; i++) {
      const idx = topK.indices[i];
      resultElement.innerText += `${topK.values[i].toFixed(5)}: ${CAFFE_MODEL.labels[idx]}\n`;
    };
  };
  img.src = 'person.jpg';
</script>
